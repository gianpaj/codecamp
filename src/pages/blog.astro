---
import type { MarkdownLayoutProps } from "astro";

import Layout from "@layouts/Layout.astro";
import Footer from "@components/Footer.astro";
import getSortedPosts from "@utils/getSortedPosts";

import { SITE } from "../config";
import type { Frontmatter } from "../types";

type Props = MarkdownLayoutProps<{
  // Define frontmatter props here
  title: string;
  author: string;
  date: string;
}>;

const { title } = Astro.props.frontmatter || Astro.props;

// const { frontmatter } = Astro.props;
const posts = await Astro.glob<Frontmatter>("./blog/**/*.md");

export async function getStaticPaths() {
  return posts.map((post) => ({
    params: {
      slug: post.frontmatter.slug,
    },
    props: {
      post,
    },
  }));
}
// Use Astro.glob() to fetch all posts, and then sort them by date.
const sortedPosts = getSortedPosts(posts);

const headTitle = `${title} - ${SITE.title}`;
---

<Layout title={headTitle}>
  <main>
    <section id="recent-posts">
      <ul>
        {
          sortedPosts.map((post) => (
            <li>
              <time datetime={post.frontmatter.publishDate}>
                {new Date(post.frontmatter.publishDate).toLocaleDateString(
                  "en-us",
                  {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                  }
                )}
              </time>
              <a href={post.url}>{post.frontmatter.title}</a>
            </li>
          ))
        }
      </ul>
    </section>
  </main>
  <style>
    #recent-posts {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
  </style>
</Layout>
